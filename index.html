<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>Cameudis's Blog - Exp10re the W0r1d</title><meta name="author" content="Cameudis"><meta name="copyright" content="Cameudis"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta property="og:type" content="website">
<meta property="og:title" content="Cameudis&#39;s Blog">
<meta property="og:url" content="https://cameudis.github.io/index.html">
<meta property="og:site_name" content="Cameudis&#39;s Blog">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://cameudis.github.io/images/ava.jpg">
<meta property="article:author" content="Cameudis">
<meta property="article:tag" content="blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cameudis.github.io/images/ava.jpg"><link rel="shortcut icon" href="/icon_blackhole.png"><link rel="canonical" href="https://cameudis.github.io/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Cameudis\'s Blog',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2023-03-19 21:12:16'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = url => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      link.onload = () => resolve()
      link.onerror = () => reject()
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/images/ava.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">78</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">21</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">10</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="Cameudis's Blog"><span class="site-name">Cameudis's Blog</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/Daily/2da7284be382.html" title="欢迎访问Cameudis的博客">欢迎访问Cameudis的博客</a><div class="article-meta-wrap"><span class="article-meta"><i class="fas fa-thumbtack sticky"></i><span class="sticky">Sticky</span><span class="article-meta-separator">|</span></span><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2022-07-15T12:26:53.000Z" title="Created 2022-07-15 20:26:53">2022-07-15</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Daily/">Daily</a></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-comments"></i><a href="/Daily/2da7284be382.html#post-comment"><span class="valine-comment-count" data-xid="/Daily/2da7284be382.html"><i class="fa-solid fa-spinner fa-spin"></i></span></a><span class="article-meta-label"> comments</span></span></div><div class="content"> 

欢迎页面，加上本站主的一些bb！
站主目前是信息安全大二就读，比较萌新，但是对建站这种事情感到非常酷炫，我也要整一个，所以用hexo和Github Pages建了这个博客。
本站点参考教程：使用hexo+github搭建免费个人博客详细教程 - 小茗同学
hexo是一个静态网页生成框架，支持md渲染成网页，有各种主题可以选择，各种配置选项，详见官方文档。hexo官方中文文档Github Pages是Github提供的静态网页托管服务，对于非商业用途免费。GitHub Pages官方中文文档评论使用Valine，教程请看使用Valine给Hexo博客添加评论功能、以及Valine Admin - 评论邮件通知、评论管理、垃圾评论过滤等加密使用hexo-blog-encrypt，教程请看hexo-blog-encrypt&#x2F;ReadMe_zh主题使用butterfly，文档请看Butterfly 安裝文檔(一) 快速開始
以及感谢nich0las学长告诉我可以这么玩！并且附上他的博客：https://nicholas-wei.github.io/
本人邮箱：&#67;&#97 ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/Daily/%E5%91%A8%E8%AE%B0/ebc24a8cf789.html" title="OSS#0x1F">OSS#0x1F</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2023-03-19T13:04:02.000Z" title="Created 2023-03-19 21:04:02">2023-03-19</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Daily/">Daily</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/Daily/%E5%91%A8%E8%AE%B0/">周记</a></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-comments"></i><a href="/Daily/%E5%91%A8%E8%AE%B0/ebc24a8cf789.html#post-comment"><span class="valine-comment-count" data-xid="/Daily/%E5%91%A8%E8%AE%B0/ebc24a8cf789.html"><i class="fa-solid fa-spinner fa-spin"></i></span></a><span class="article-meta-label"> comments</span></span></div><div class="content">本周是睡眠质量很差的一周，心情不是很好，不过经过两天回家的修养之后，现在心情还算不错。
学业上没啥特别好说的。周末打WolvCTF，在前辈的帮助下AK了PWN，很有成就感！虽然都是基础题。
另外，这学期有望读完《欢迎光临社会学》，只要每周看一章即可。这周是第四周，正好看完第四章。这本书真的很好看很有意思，感觉学到很多。一位读政治学与行政学的朋友（知乎）又给我推荐了两本入门的书，一本是吉登斯《社会学》，一本是《社会学的邀请》，我想等现在手上这套读完之后再看看这两本书。学习是需要重复的，看多本不同的书可能能帮我更好地学习。另外，学习是需要实践的，下周开始我得逼着自己做一些书上的练习了，这需要我这社恐宅宅跨出宿舍门。我得勇敢点。
</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/Tech/PoRE/63955eff56fa.html" title="PoRE#0x2 Android APP Reverse PartII">PoRE#0x2 Android APP Reverse PartII</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2023-03-13T15:45:40.000Z" title="Created 2023-03-13 23:45:40">2023-03-13</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Tech/">Tech</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/Tech/PoRE/">PoRE</a></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-comments"></i><a href="/Tech/PoRE/63955eff56fa.html#post-comment"><span class="valine-comment-count" data-xid="/Tech/PoRE/63955eff56fa.html"><i class="fa-solid fa-spinner fa-spin"></i></span></a><span class="article-meta-label"> comments</span></span></div><div class="content">上篇见 这里本篇施工中……


4 Advanced App Features4.1 Multi-threading多线程是一种常见的提升程序性能的技术，在 Android 中也普遍使用。比如，Android 中所有的 UI 交互都是由一个线程来处理的，这个线程被称为 UI Thread。实际上，这个线程就是应用程序的主线程（Main Thread），大部分组件都运行在这个线程中。有些耗时的操作不能在主线程中运行（比如网络相关的操作），开发者需要手动为其开启新的线程。当这些工作线程需要操作 UI 时，他们通过发消息给 UI 线程完成。
接下来介绍 Java 中创建线程的方法、UI 线程、以及线程间交互的方法（包括复杂的 Asynchronous Messaging 与简化后的 AsyncTask）。
4.1.1 Java Multi-threading参考：Java 多线程编程 | 菜鸟教程 (runoob.com)
&#x2F;&#x2F; TODO
4.1.2 Android UI Thread所有与 UI 相关的操作都在 UI 线程中进行，换句话说，想要进行 UI 操作，就必须通 ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/Tech/Pwn/a45521a4b6a2.html" title="【UTCTF 2023】Printfail writeup">【UTCTF 2023】Printfail writeup</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2023-03-12T13:28:13.000Z" title="Created 2023-03-12 21:28:13">2023-03-12</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Tech/">Tech</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/Tech/Pwn/">Pwn</a></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-comments"></i><a href="/Tech/Pwn/a45521a4b6a2.html#post-comment"><span class="valine-comment-count" data-xid="/Tech/Pwn/a45521a4b6a2.html"><i class="fa-solid fa-spinner fa-spin"></i></span></a><span class="article-meta-label"> comments</span></span></div><div class="content">非栈上的格式化字符串利用。


非栈上的格式化字符串利用方法参考文章：非栈上格式化字符串漏洞利用技巧-安全客
想用格式化字符串来覆写任意位置的数据时，通常是把指针附在字符串的末尾，然后用 %k$n 来引用这个指针。但是如果程序不在栈上读取字符串，就没有办法指向自定义的指针了。
当然，方法依然存在，就是利用栈上已有的指针。在 64 位环境下，如果栈上存在一个指另一个指另一个的三级链结构（也就是两个指向栈的指针），就仍旧可以构造出任意的指针，如下图所示：
123456789101112131415161718┌────────────────┐│                │├────────────────┤│First PTR       │├──────────────┬─┤│              │ ││              │ │├────────────┬─▼─┤│Second PTR  │   │├────────────┴─┬─┤│              │ ││  ┌───┬───┬───┤ ││  │   │   │   │ │├──▼─┬─▼─┬─ ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/Daily/%E5%91%A8%E8%AE%B0/80620bf1d91a.html" title="OSS#0x1E">OSS#0x1E</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2023-03-12T12:47:23.000Z" title="Created 2023-03-12 20:47:23">2023-03-12</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Daily/">Daily</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/Daily/%E5%91%A8%E8%AE%B0/">周记</a></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-comments"></i><a href="/Daily/%E5%91%A8%E8%AE%B0/80620bf1d91a.html#post-comment"><span class="valine-comment-count" data-xid="/Daily/%E5%91%A8%E8%AE%B0/80620bf1d91a.html"><i class="fa-solid fa-spinner fa-spin"></i></span></a><span class="article-meta-label"> comments</span></span></div><div class="content">本周在课业外，主要在学pwn。练习了几道pwn题，学到了一些新的技巧。周四到周日参加了HackIM CTF、UTCTF还有pwnhub公开赛（拿了个邀请码）。不过课业方面稍有落下，这个故事告诉我们睡眠一定要充足一些。
另外，有两门课非常折磨，一门是数据库引论，还有就是PoRE。
前者折磨可能是因为老师讲得很慢，感觉有点抓不到整体的逻辑；讲实验课尤其是有点听不进去，实话实说讲得很不友好……上学期老师讲离散讲得慢一些感觉挺好的，数学慢一些便于自己思考（所以这学期还是追随了这位老师）；不过教数据库嘛……总之还是自学吧，自学吧。据说这门课最后重点是前端，感觉有点那个。
后者折磨主要是因为速成。没有午睡，第一节课听着听着就困到不行睡着了。然后课上信息量其实又挺大的，又没有实践能直接通过例子接触这些概念，总之就是上课很困，像信安导论一样困。总之还是自学吧，自学吧……好好写PoRE系列笔记，力求勉强能跟上老师讲的东西……
本来还想开新坑的呢，比如学一下OS啥的，现在看根本没有时间和精力。今天从起床到下午四点才把这周抽代的内容看明白一遍+把作业写了，实在是有点难。希望自己能学会差不多得了精神！然后多在 ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/Tech/Pwn/b40f5afe3eeb.html" title="【HackIM CTF 2023】spygame writeup">【HackIM CTF 2023】spygame writeup</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2023-03-10T11:59:14.000Z" title="Created 2023-03-10 19:59:14">2023-03-10</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Tech/">Tech</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/Tech/Pwn/">Pwn</a></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-comments"></i><a href="/Tech/Pwn/b40f5afe3eeb.html#post-comment"><span class="valine-comment-count" data-xid="/Tech/Pwn/b40f5afe3eeb.html"><i class="fa-solid fa-spinner fa-spin"></i></span></a><span class="article-meta-label"> comments</span></span></div><div class="content">我们CTF萌新小分队已经达到了4人之多(&#96;ヮ´)，这次排名41&#x2F;433，感觉很好~这道题有十个队做出来，很高兴我也弄出来了，还顺便大致学会了docker配本地环境，挺感动的~~
漏洞：随机数未设种子、数组下标溢出

程序逻辑程序给了 N 个代码源文件以及DockerFile。主要逻辑是用 C code 写的，但是封装成了一个 Python 可以调用的模块，名为 spy，相关信息参考python文档 Extending Python with C or C++ — Python 3.11.2 documentation。
game.py 会让玩家选择游戏模式（easy or hard），然后调用 spy 模块的接口，如果返回通过就把 flag 打印出来。spy 模块的主要逻辑大致如下：

首先进行八轮循环，每轮循环中：
生成一个固定大小的数组，元素类型 uint8_t
随机取两个数交换
打印交换后的数组
玩家输入两个 index（这一步将会计时，并分别将前后的时间保存到局部变量 start_ns 和 end_ns 中）
程序交换两个 index 的值
程序检查交换后数组 ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/Tech/PoRE/4ac4cf560d13.html" title="PoRE#0x1 Android APP Reverse PartI">PoRE#0x1 Android APP Reverse PartI</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2023-03-08T10:08:00.000Z" title="Created 2023-03-08 18:08:00">2023-03-08</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Tech/">Tech</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/Tech/PoRE/">PoRE</a></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-comments"></i><a href="/Tech/PoRE/4ac4cf560d13.html#post-comment"><span class="valine-comment-count" data-xid="/Tech/PoRE/4ac4cf560d13.html"><i class="fa-solid fa-spinner fa-spin"></i></span></a><span class="article-meta-label"> comments</span></span></div><div class="content">下篇见 这里


上周老师带我们速通了 Android 的 APK 结构、架构以及 Android 系统本身的架构，本人课上走了一会神就再也跟不上了，课后一边 STFW 一边过了一遍 PPT，现在再用这篇笔记过一遍。（可能存在一些错误，希望看到能顺手和俺说下）
本篇笔记分为三个部分，App、System 以及 SDK。
1 Android App安卓 APP 具有三种形态：

source code
APK（安装包）
App（安装好的软件）其中，APK 几乎等价于 App，例如安卓 QQ 就可以直接导出一个软件 APK（虽然有几率出现问题）。课程讲述逆向工程，直接用 APK 的视角来讲述一个安卓软件；但我们这里也可以采取另一种视角 —— 先来看看 source code 阶段的安卓 App 是什么样的。

1.1 source code在 source code 阶段，App 由 .java 源代码、.xml 数据文件以及别的一些多媒体资源组成。上述的三种文件，大致通过下面的结构被组织起来：

manifests 文件夹：存放 AndroidManifest.xml
java 文件夹： ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/Tech/Pwn/33ac9256da88.html" title="【*CTF 2018】babystack">【*CTF 2018】babystack</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2023-03-08T02:25:50.000Z" title="Created 2023-03-08 10:25:50">2023-03-08</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Tech/">Tech</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/Tech/Pwn/">Pwn</a></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-comments"></i><a href="/Tech/Pwn/33ac9256da88.html#post-comment"><span class="valine-comment-count" data-xid="/Tech/Pwn/33ac9256da88.html"><i class="fa-solid fa-spinner fa-spin"></i></span></a><span class="article-meta-label"> comments</span></span></div><div class="content">攻击GLIBC的TLS结构体，覆写Canary。快速学习了一下Pthread，大致知道了多线程的用法。


starctf2018&#x2F;pwn-babystack at master · sixstars&#x2F;starctf2018 (github.com)
GLIBC 不仅把 Canary 放在 TLS（Thread Local Storage）中，还把 TLS 放在线程栈顶上（与线程栈有固定的偏移）。这就出现了覆写 Canary 的可能。

漏洞分析程序逻辑很简单，就是开一个线程，然后这个线程里存在一个超大的栈溢出。
程序会用寄存器 fs 来存储 TLS 的位置，而 canary 就在 fs+0x28 的地方，如下结构体定义所示：
12345678910111213typedef struct  &#123;    void *tcb;        /* Pointer to the TCB.  Not necessarily the                 thread descriptor used by libpthread.  */    dtv_t  ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/Tech/Pwn/80789099dd23.html" title="【NJCTF 2017】messager">【NJCTF 2017】messager</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2023-03-07T14:24:20.000Z" title="Created 2023-03-07 22:24:20">2023-03-07</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Tech/">Tech</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/Tech/Pwn/">Pwn</a></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-comments"></i><a href="/Tech/Pwn/80789099dd23.html#post-comment"><span class="valine-comment-count" data-xid="/Tech/Pwn/80789099dd23.html"><i class="fa-solid fa-spinner fa-spin"></i></span></a><span class="article-meta-label"> comments</span></span></div><div class="content">省流：Canary爆破，顺便复习了一下Linux socket API，还知道了IDA View下右键数值常量可以查找对应的枚举名（前提是要指知道枚举名的开头）（比如AF_INET、SOCK_STREAM等）。


程序逆向一开始程序创建了一个监听套接字，逆向得到逻辑大致如下：
123456789static struct sockaddr_in addr;addr.sin_family = AF_INET;addr.sin_port = htons(5555);addr.sin_addr.s_addr = htonl(0);    // 0.0.0.0static int listen_fd = socket(AF_INET, SOCK_STREAM, 0);setsockopt(listen_fd, ...);bind(listen_fd, &amp;addr, 0x10);listen(listen_fd, 0x400);

创建完毕后，主进程进入 accept-fork-close 循环。而 fork 出的子进程会调用函数 sub_400BE9 从套接字读取输入（存在栈溢出）， ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/Tech/Network/57e49cd58f92.html" title="自顶向下笔记#Ch1">自顶向下笔记#Ch1</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time datetime="2023-03-06T09:18:58.000Z" title="Created 2023-03-06 17:18:58">2023-03-06</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Tech/">Tech</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/Tech/Network/">Network</a></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-comments"></i><a href="/Tech/Network/57e49cd58f92.html#post-comment"><span class="valine-comment-count" data-xid="/Tech/Network/57e49cd58f92.html"><i class="fa-solid fa-spinner fa-spin"></i></span></a><span class="article-meta-label"> comments</span></span></div><div class="content">1.1 What is Internet软硬件实现角度：各种各样的终端设备 end system通过线路和 packet switch 链接在一起，中间有一张大网——因特网核心。终端设备通过 ISP（Internet Service Provider）与这张大网连接在一起，ISP 之间也互相连接。在 end system、packet switch 等网络设备上进行传输的，是遵守协议 Protocal的数据包，作为所有设备间的约定来规范网络上的数据形式。这些规则大部分由 IETF 制定，称为 RFCs，也有由 IEEE 等组织指定的标准。
功能角度：在终端的眼中，网络是提供服务和应用的基础设施。终端可以借助网络接口来使用或构建分布式应用。
1.2 The Network Edge在网络的边缘，有各式各样的网络的终端设备，比如 PC、服务器、移动设备、以及越来越多的各式智能联网设备（The Internet Of Things），它们都可以被称为 host。不过很多时候，这些 host 有着 client 或者 server 的差异。
1.2.1 Access Internet接入网络  ...</div></div></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/#content-inner">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/#content-inner">8</a><a class="extend next" rel="next" href="/page/2/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/images/ava.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Cameudis</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">78</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">21</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">10</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/cameudis"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>Announcement</span></div><div class="announcement_content">大家都要学习、学习、再学习。应该学会毛泽东同志所提倡的“挤”和“钻”的精神，先挤出时间来学习，然后再钻研进去。没有一股自觉地挤劲和钻劲，是学不好的。——江泽民：《讲学习，讲政治，讲正气》</div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/Daily/%E5%91%A8%E8%AE%B0/ebc24a8cf789.html" title="OSS#0x1F">OSS#0x1F</a><time datetime="2023-03-19T13:04:02.000Z" title="Created 2023-03-19 21:04:02">2023-03-19</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/Tech/PoRE/63955eff56fa.html" title="PoRE#0x2 Android APP Reverse PartII">PoRE#0x2 Android APP Reverse PartII</a><time datetime="2023-03-13T15:45:40.000Z" title="Created 2023-03-13 23:45:40">2023-03-13</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/Tech/Pwn/a45521a4b6a2.html" title="【UTCTF 2023】Printfail writeup">【UTCTF 2023】Printfail writeup</a><time datetime="2023-03-12T13:28:13.000Z" title="Created 2023-03-12 21:28:13">2023-03-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/Daily/%E5%91%A8%E8%AE%B0/80620bf1d91a.html" title="OSS#0x1E">OSS#0x1E</a><time datetime="2023-03-12T12:47:23.000Z" title="Created 2023-03-12 20:47:23">2023-03-12</time></div></div><div class="aside-list-item no-cover"><div class="content"><a class="title" href="/Tech/Pwn/b40f5afe3eeb.html" title="【HackIM CTF 2023】spygame writeup">【HackIM CTF 2023】spygame writeup</a><time datetime="2023-03-10T11:59:14.000Z" title="Created 2023-03-10 19:59:14">2023-03-10</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>Categories</span>
            <a class="card-more-btn" href="/categories/" title="More">
    <i class="fas fa-angle-right"></i></a>
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Daily/"><span class="card-category-list-name">Daily</span><span class="card-category-list-count">44</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Daily/%E5%91%A8%E8%AE%B0/"><span class="card-category-list-name">周记</span><span class="card-category-list-count">32</span></a></li></ul></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Tech/"><span class="card-category-list-name">Tech</span><span class="card-category-list-count">33</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Tech/Algorithm/"><span class="card-category-list-name">Algorithm</span><span class="card-category-list-count">2</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Tech/Blog/"><span class="card-category-list-name">Blog</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Tech/CSAPP/"><span class="card-category-list-name">CSAPP</span><span class="card-category-list-count">5</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Tech/EE/"><span class="card-category-list-name">EE</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Tech/Network/"><span class="card-category-list-name">Network</span><span class="card-category-list-count">1</span></a></li></ul></li>
            </ul></div><div class="card-widget card-tags"><div class="item-headline"><i class="fas fa-tags"></i><span>Tags</span></div><div class="card-tag-cloud"><a href="/tags/BUUCTF/" style="font-size: 1.1em; color: #999">BUUCTF</a> <a href="/tags/CSAPP/" style="font-size: 1.33em; color: #99a2af">CSAPP</a> <a href="/tags/Network/" style="font-size: 1.1em; color: #999">Network</a> <a href="/tags/OSS/" style="font-size: 1.5em; color: #99a9bf">OSS</a> <a href="/tags/PoRE/" style="font-size: 1.21em; color: #999ea4">PoRE</a> <a href="/tags/Tool/" style="font-size: 1.1em; color: #999">Tool</a> <a href="/tags/UAF/" style="font-size: 1.16em; color: #999b9e">UAF</a> <a href="/tags/format-string/" style="font-size: 1.1em; color: #999">format_string</a> <a href="/tags/heap/" style="font-size: 1.16em; color: #999b9e">heap</a> <a href="/tags/hexo/" style="font-size: 1.1em; color: #999">hexo</a> <a href="/tags/pwn-college/" style="font-size: 1.27em; color: #99a0a9">pwn.college</a> <a href="/tags/pwnable-tw/" style="font-size: 1.44em; color: #99a7ba">pwnable.tw</a> <a href="/tags/ret2dlresolve/" style="font-size: 1.1em; color: #999">ret2dlresolve</a> <a href="/tags/rop/" style="font-size: 1.1em; color: #999">rop</a> <a href="/tags/stack-overflow/" style="font-size: 1.39em; color: #99a4b4">stack_overflow</a> <a href="/tags/stack-pivot/" style="font-size: 1.16em; color: #999b9e">stack_pivot</a> <a href="/tags/%E5%8D%9A%E5%AE%A2/" style="font-size: 1.1em; color: #999">博客</a> <a href="/tags/%E6%95%99%E8%82%B2/" style="font-size: 1.16em; color: #999b9e">教育</a> <a href="/tags/%E6%95%B0%E5%AD%97%E9%80%BB%E8%BE%91/" style="font-size: 1.1em; color: #999">数字逻辑</a> <a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" style="font-size: 1.16em; color: #999b9e">数据结构与算法</a> <a href="/tags/%E6%9D%82%E8%B0%88/" style="font-size: 1.33em; color: #99a2af">杂谈</a></div></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>Archives</span><a class="card-more-btn" href="/archives/" title="More">
    <i class="fas fa-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/03/"><span class="card-archive-list-date">March 2023</span><span class="card-archive-list-count">11</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/02/"><span class="card-archive-list-date">February 2023</span><span class="card-archive-list-count">6</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/01/"><span class="card-archive-list-date">January 2023</span><span class="card-archive-list-count">7</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/12/"><span class="card-archive-list-date">December 2022</span><span class="card-archive-list-count">3</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/11/"><span class="card-archive-list-date">November 2022</span><span class="card-archive-list-count">7</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/10/"><span class="card-archive-list-date">October 2022</span><span class="card-archive-list-count">11</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/09/"><span class="card-archive-list-date">September 2022</span><span class="card-archive-list-count">11</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2022/08/"><span class="card-archive-list-date">August 2022</span><span class="card-archive-list-count">9</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>Info</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">Article :</div><div class="item-count">78</div></div><div class="webinfo-item"><div class="item-name">UV :</div><div class="item-count" id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">PV :</div><div class="item-count" id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">Last Push :</div><div class="item-count" id="last-push-date" data-lastPushDate="2023-03-19T13:12:16.242Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2023 By Cameudis</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Exp10re the W0r1d!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"><script>(() => {
  function loadValine () {
    function initValine () {
      let initData = {
        el: '#vcomment',
        appId: 'Ji5y9HTOlb2QGDO0XFlWXNRy-gzGzoHsz',
        appKey: '6VqGye1352LX381YQDTOaiXs',
        serverURLs: ''
      }
      
      const valine = new Valine(initData)
    }

    if (typeof Valine === 'function') initValine() 
    else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
  }

  window.pjax ? loadValine() : window.addEventListener('load', loadValine)
})()</script></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="false" data-click="true"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>