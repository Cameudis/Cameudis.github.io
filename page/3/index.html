<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"><title>Cameudis's Blog - Exp10re the W0r1d</title><meta name="author" content="Cameudis"><meta name="copyright" content="Cameudis"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta property="og:type" content="website">
<meta property="og:title" content="Cameudis&#39;s Blog">
<meta property="og:url" content="https://www.cameudis.com/page/3/index.html">
<meta property="og:site_name" content="Cameudis&#39;s Blog">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://www.cameudis.com/images/ava1.jpg">
<meta property="article:author" content="Cameudis">
<meta property="article:tag" content="blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://www.cameudis.com/images/ava1.jpg"><link rel="shortcut icon" href="/icon_blackhole.png"><link rel="canonical" href="https://www.cameudis.com/page/3/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Cameudis\'s Blog',
  isPost: false,
  isHome: true,
  isHighlightShrink: false,
  isToc: false,
  postUpdate: '2023-12-25 10:48:02'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = url => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      link.onload = () => resolve()
      link.onerror = () => reject()
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/images/ava1.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">60</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">14</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div></div></div><div class="page" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="Cameudis's Blog"><span class="site-name">Cameudis's Blog</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> Home</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> Archives</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> Categories</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> Link</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> About</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div class="recent-posts" id="recent-posts"><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/Tech/Pwn/33ac9256da88.html" title="【Pwn#0x0C】*CTF 2018 babystack">【Pwn#0x0C】*CTF 2018 babystack</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-03-08T02:25:50.000Z" title="Created 2023-03-08 10:25:50">2023-03-08</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2023-10-30T15:16:10.324Z" title="Updated 2023-10-30 23:16:10">2023-10-30</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Tech/">Tech</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/Tech/Pwn/">Pwn</a></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-comments"></i><a href="/Tech/Pwn/33ac9256da88.html#post-comment"><span class="valine-comment-count" data-xid="/Tech/Pwn/33ac9256da88.html"><i class="fa-solid fa-spinner fa-spin"></i></span></a><span class="article-meta-label"> comments</span></span></div><div class="content">攻击GLIBC的TLS结构体，覆写Canary。快速学习了一下Pthread，大致知道了多线程的用法。


starctf2018&#x2F;pwn-babystack at master · sixstars&#x2F;starctf2018 (github.com)
GLIBC 不仅把 Canary 放在 TLS（Thread Local Storage）中，还把 TLS 放在线程栈顶上（与线程栈有固定的偏移）。这就出现了覆写 Canary 的可能。

漏洞分析程序逻辑很简单，就是开一个线程，然后这个线程里存在一个超大的栈溢出。
程序会用寄存器 fs 来存储 TLS 的位置，而 canary 就在 fs+0x28 的地方，如下结构体定义所示：
12345678910111213typedef struct  &#123;    void *tcb;        /* Pointer to the TCB.  Not necessarily the                 thread descriptor used by libpthread.  */    dtv_t  ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/Tech/Pwn/80789099dd23.html" title="【Pwn#0x0B】NJCTF 2017 messager">【Pwn#0x0B】NJCTF 2017 messager</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-03-07T14:24:20.000Z" title="Created 2023-03-07 22:24:20">2023-03-07</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2023-10-30T15:15:42.414Z" title="Updated 2023-10-30 23:15:42">2023-10-30</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Tech/">Tech</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/Tech/Pwn/">Pwn</a></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-comments"></i><a href="/Tech/Pwn/80789099dd23.html#post-comment"><span class="valine-comment-count" data-xid="/Tech/Pwn/80789099dd23.html"><i class="fa-solid fa-spinner fa-spin"></i></span></a><span class="article-meta-label"> comments</span></span></div><div class="content">省流：Canary爆破，顺便复习了一下Linux socket API，还知道了IDA View下右键数值常量可以查找对应的枚举名（前提是要指知道枚举名的开头）（比如AF_INET、SOCK_STREAM等）。


程序逆向一开始程序创建了一个监听套接字，逆向得到逻辑大致如下：
123456789static struct sockaddr_in addr;addr.sin_family = AF_INET;addr.sin_port = htons(5555);addr.sin_addr.s_addr = htonl(0);    // 0.0.0.0static int listen_fd = socket(AF_INET, SOCK_STREAM, 0);setsockopt(listen_fd, ...);bind(listen_fd, &amp;addr, 0x10);listen(listen_fd, 0x400);

创建完毕后，主进程进入 accept-fork-close 循环。而 fork 出的子进程会调用函数 sub_400BE9 从套接字读取输入（存在栈溢出）， ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/Tech/Network/57e49cd58f92.html" title="【Network#0x00】自顶向下笔记#Ch1">【Network#0x00】自顶向下笔记#Ch1</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-03-06T09:18:58.000Z" title="Created 2023-03-06 17:18:58">2023-03-06</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2023-10-30T15:07:39.104Z" title="Updated 2023-10-30 23:07:39">2023-10-30</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Tech/">Tech</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/Tech/Network/">Network</a></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-comments"></i><a href="/Tech/Network/57e49cd58f92.html#post-comment"><span class="valine-comment-count" data-xid="/Tech/Network/57e49cd58f92.html"><i class="fa-solid fa-spinner fa-spin"></i></span></a><span class="article-meta-label"> comments</span></span></div><div class="content">1.1 What is Internet软硬件实现角度：各种各样的终端设备 end system通过线路和 packet switch 链接在一起，中间有一张大网——因特网核心。终端设备通过 ISP（Internet Service Provider）与这张大网连接在一起，ISP 之间也互相连接。在 end system、packet switch 等网络设备上进行传输的，是遵守协议 Protocal的数据包，作为所有设备间的约定来规范网络上的数据形式。这些规则大部分由 IETF 制定，称为 RFCs，也有由 IEEE 等组织指定的标准。
功能角度：在终端的眼中，网络是提供服务和应用的基础设施。终端可以借助网络接口来使用或构建分布式应用。
1.2 The Network Edge在网络的边缘，有各式各样的网络的终端设备，比如 PC、服务器、移动设备、以及越来越多的各式智能联网设备（The Internet Of Things），它们都可以被称为 host。不过很多时候，这些 host 有着 client 或者 server 的差异。
1.2.1 Access Internet接入网络  ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/Tech/PoRE/5acc028df792.html" title="【PoRE#0x00】欢迎来到逆向工程原理">【PoRE#0x00】欢迎来到逆向工程原理</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-03-03T08:43:28.000Z" title="Created 2023-03-03 16:43:28">2023-03-03</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2023-10-30T15:06:22.044Z" title="Updated 2023-10-30 23:06:22">2023-10-30</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Tech/">Tech</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/Tech/PoRE/">PoRE</a></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-comments"></i><a href="/Tech/PoRE/5acc028df792.html#post-comment"><span class="valine-comment-count" data-xid="/Tech/PoRE/5acc028df792.html"><i class="fa-solid fa-spinner fa-spin"></i></span></a><span class="article-meta-label"> comments</span></span></div><div class="content">为了在学校的高强度课程《逆向工程原理 Principles of Reverse Engineer》存活下来，站主决定开启一个系列笔记，并同步到博客上。目标是将课程以及实验的要点以人话讲清楚，整理一些便于查询的cheatsheet，并尝试拓展学习一些有趣的内容，以便同学和自己参考。（如果有同学看的话(´_ゝ&#96;)）
本期作为第0期，主要记录课程的基础设施使用方法。


在 PoRE 中使用 git本课程所有的 slides 获取、作业获取以及作业提交都通过 GIT 完成。GIT 作为一个分布式的版本控制软件，自然有强大的文件同步功能，能在客户端和服务器之间同步文件。
完整的 GIT 系统是经典的客户端-服务端架构，服务器上存储了 GIT 仓库。我们经常使用的 github，提供了 GIT 仓库的托管服务。而在PoRE课程中，我们使用的是课程搭建的 GIT 服务器。在课程 GIT 服务器上，有如下一些仓库（repository，简称repo）：

release：LAB 的分发版本
pore_2130xxx0xxx：每个人的个人仓库，主要用于提交
slides：存放课程的 slid ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/Tech/Pwn/7e0b30214381.html" title="【Pwn#0x0A】pwnable.tw tcache_tear writeup">【Pwn#0x0A】pwnable.tw tcache_tear writeup</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-02-01T07:16:30.000Z" title="Created 2023-02-01 15:16:30">2023-02-01</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2023-10-30T15:15:20.984Z" title="Updated 2023-10-30 23:15:20">2023-10-30</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Tech/">Tech</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/Tech/Pwn/">Pwn</a></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-comments"></i><a href="/Tech/Pwn/7e0b30214381.html#post-comment"><span class="valine-comment-count" data-xid="/Tech/Pwn/7e0b30214381.html"><i class="fa-solid fa-spinner fa-spin"></i></span></a><span class="article-meta-label"> comments</span></span></div><div class="content">完全自己做出来的一个堆题，算是入门堆利用了吧哈哈。
程序分析GLIBC 2.27 64bits，关闭了 PIE。菜单题，提供了 alloc、free、info、exit 四个功能。

通过 alloc，用户可以自由申请小于 0xff（不含 chunk header）大小的区块并向其中填入 size-0x16 个任意字符（奇怪的限制）。整个程序只有一个放指针的槽位，是一个全局符号，记为gptr。
通过 free，用户可以释放全局符号 gptr 指向的空间。但程序使用局部变量作了限制，程序最多只能 free 8 次。漏洞：free 完没有清空指针
通过 info，用户可以用 write 打印全局符号 name 处的值。这个符号本没有名字，但程序一开始会让我们输入一个 name 存储在这个符号的位置，所以就叫他 name。
通过 exit，用户可以退出程序。

程序没有什么自带的后门函数，orw 的三个函数都不齐。
思路结合分析可以看出，必须要泄露 libc 基址才能搞事情。所以需要在 2.27 的版本下，想办法绕过 tcache 让 chunk 进入 unsorted bin 来获取 li ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/Tech/Pwn/c372e83f29fd.html" title="【Pwn#0x09】ZCTF 2016 note2">【Pwn#0x09】ZCTF 2016 note2</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-01-16T07:59:08.000Z" title="Created 2023-01-16 15:59:08">2023-01-16</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2023-10-30T15:18:47.034Z" title="Updated 2023-10-30 23:18:47">2023-10-30</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Tech/">Tech</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/Tech/Pwn/">Pwn</a></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-comments"></i><a href="/Tech/Pwn/c372e83f29fd.html#post-comment"><span class="valine-comment-count" data-xid="/Tech/Pwn/c372e83f29fd.html"><i class="fa-solid fa-spinner fa-spin"></i></span></a><span class="article-meta-label"> comments</span></span></div><div class="content">正在学习Unlink - CTF wiki，参考上面的方法自己打了一遍，其实是感觉上面的方法有些不必要的步骤，因此自己做的时候简化了一下……
题目分析ubuntu16 64bit 菜单题Partial RELRO，no PIE –&gt; 可以覆写 GOT 进行攻击
提供了四个功能：

添加 note，size 限制小于等于 0x80 且会被记录，note 指针会被记录。
展示 note 内容。
编辑 note 内容，其中包括覆盖已有的 note，在已有的 note 后面添加内容。
释放 note。

程序存在两个漏洞：

在添加 note 时，程序会提供写入 note 内容的功能。这里使用了一个循环且每次读取一个字符的自己写的读取函数，循环次数是 size-1 次，然而比较是无符号数比较（看来以后 for 循环里的比较符号类型也要好好注意）。所以如果 size 是 0 的话，程序就会一直读取，是一个堆溢出漏洞。
在编辑 note 时，程序采用及其奇怪的各种字符串操作来读取。不解释原理地简单来说，如果编辑的 note 之前 size 填入的是 0 ，而且输入的字符串大小大于 0 的话， ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/Tech/CSAPP/049e546f6ef6.html" title="【CSAPP#0x02】程序：从源码到终止">【CSAPP#0x02】程序：从源码到终止</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-01-12T11:45:14.000Z" title="Created 2023-01-12 19:45:14">2023-01-12</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2023-10-30T15:25:14.154Z" title="Updated 2023-10-30 23:25:14">2023-10-30</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Tech/">Tech</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/Tech/CSAPP/">CSAPP</a></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-comments"></i><a href="/Tech/CSAPP/049e546f6ef6.html#post-comment"><span class="valine-comment-count" data-xid="/Tech/CSAPP/049e546f6ef6.html"><i class="fa-solid fa-spinner fa-spin"></i></span></a><span class="article-meta-label"> comments</span></span></div><div class="content">概述本文将从源代码开始，追溯一个简单程序从编译到运行结束的全过程。系统环境是 WSL2 Ubuntu 20.04.5 LTS，编译使用 gcc 和 glibc 版本为 gcc (Ubuntu 9.4.0-1ubuntu1~20.04.1) 9.4.0 以及 GLIBC 2.31-0ubuntu9.9。使用的程序代码如下：
12345678#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;int main() &#123;	char *s = (char*)malloc(16);	scanf(&quot;%15s&quot; , s);	printf(&quot;Hello %s\n&quot; , s);	return 0;&#125;

1 编译和链接我们平时使用的”编译器”gcc，其全称是 GNU Compiler Collection，是一套组合程序，即教材中的 compiler driver。gcc将程序编译为完整程序的过程可以分为如下几步：

预编译：C 预编译器 cpp 会处理源代码中的宏以及引用，并简化代码（删除所有注释，调 ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/Tech/Pwn/315b637e69b6.html" title="【Pwn#0x08】0CTF 2017 babyheap">【Pwn#0x08】0CTF 2017 babyheap</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2023-01-11T02:06:09.000Z" title="Created 2023-01-11 10:06:09">2023-01-11</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2023-10-30T15:14:32.714Z" title="Updated 2023-10-30 23:14:32">2023-10-30</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Tech/">Tech</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/Tech/Pwn/">Pwn</a></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-comments"></i><a href="/Tech/Pwn/315b637e69b6.html#post-comment"><span class="valine-comment-count" data-xid="/Tech/Pwn/315b637e69b6.html"><i class="fa-solid fa-spinner fa-spin"></i></span></a><span class="article-meta-label"> comments</span></span></div><div class="content">放寒假了，于是我把ptmalloc2机制又重新学习了一遍，开始做点简单的堆利用题了！本题一半抄一半自己摸，也算是基本搞懂了，这里放一个笔记。
基础信息：ubuntu16（glibc2.23），菜单题，64 位，保护全开。提供 alloc、 free、dump、fill 功能，同时允许分配 16 个区块。
漏洞：fill 功能可以向区块写入任意长度信息，也就是堆溢出。
由于保护全开，于是 pwn 的目标便是：

泄露 libc 地址
修改__malloc_hook 为 libc 中的 one gadget

泄露 libc 地址ubuntu16 下没有 tcache 机制，因此只有 fast bins 和 3 个普通的 bins。其中，fast bins 以单链表形式维护，非循环链表，因此无法泄露 main_arena 的 malloc_struct 地址。而普通 bins 都是循环链表，large bins 比较复杂，但 unsorted bins 和 small bins 中的 chunk 都会有指向 arena 的指针。
我们需要泄露这个指针，就需要想办法构造 UAF 或者 ove ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/Daily/%E6%9D%82%E8%B0%88/803421a18fc9.html" title="【杂谈#0x04】">【杂谈#0x04】</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-12-09T10:46:46.000Z" title="Created 2022-12-09 18:46:46">2022-12-09</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2023-10-30T15:05:27.664Z" title="Updated 2023-10-30 23:05:27">2023-10-30</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Daily/">Daily</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/Daily/%E6%9D%82%E8%B0%88/">杂谈</a></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-comments"></i><a href="/Daily/%E6%9D%82%E8%B0%88/803421a18fc9.html#post-comment"><span class="valine-comment-count" data-xid="/Daily/%E6%9D%82%E8%B0%88/803421a18fc9.html"><i class="fa-solid fa-spinner fa-spin"></i></span></a><span class="article-meta-label"> comments</span></span></div><div class="content">最近发生了很多事情，但我也总结不出什么道理，所以就写个杂谈来分享下我看到的事情和我的感受吧。
第一是疫情防控的急速转变。从乌鲁木齐市的大火开始，网上就有一股强大的反抗当前防疫政策的力量出现了。那段时间是我朋友圈里，不存在的文章占比最高的一段时间。甚至不仅仅是网上，在现实中也有许多人开始抗议，以举白纸的方式。这很显然是多个因素推动造成的，其中不乏境外势力的推动。但是不论因素是什么，民众中已经形成一股怨气了。可想而知，不论多么小心，未来一定会有类似乌鲁木齐大火一样的惨剧发生，这是中国作为一个大国所无法避免的，这里的大说的是规模、人口、差异之大。而网络的存在又消除了信息的传播限制，使得全国都能获取到事件的相关信息，使这股怨气仿佛滚雪球一般越传越大。因此在这种情况下，选择放开是十分合理的措施，并且一定要放开到让老百姓意识到明显不同的程度。所以现在大的真的来了：
pafd。出校刷卡。线上。提前。推迟。后续安排问卷。活动取消。离校。抢票。见证历史。一时间所有的东西都转了起来。
第二是不可抗力带来的迷茫。在这周三四五，我每天都遭受了一次课业上的打击。周三错过了一学期只点名一次的毛概点名；周四在集合与 ...</div></div></div><div class="recent-post-item"><div class="recent-post-info no-cover"><a class="article-title" href="/Tech/Pwn/508d7fe62c17.html" title="【Pwn#0x07】THUCTF 2022 babystack_level3">【Pwn#0x07】THUCTF 2022 babystack_level3</a><div class="article-meta-wrap"><span class="post-meta-date"><i class="far fa-calendar-alt"></i><span class="article-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-11-15T06:11:48.000Z" title="Created 2022-11-15 14:11:48">2022-11-15</time><span class="article-meta-separator">|</span><i class="fas fa-history"></i><span class="article-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2023-10-30T15:22:55.644Z" title="Updated 2023-10-30 23:22:55">2023-10-30</time></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-inbox"></i><a class="article-meta__categories" href="/categories/Tech/">Tech</a><i class="fas fa-angle-right article-meta-link"></i><a class="article-meta__categories" href="/categories/Tech/Pwn/">Pwn</a></span><span class="article-meta"><span class="article-meta-separator">|</span><i class="fas fa-comments"></i><a href="/Tech/Pwn/508d7fe62c17.html#post-comment"><span class="valine-comment-count" data-xid="/Tech/Pwn/508d7fe62c17.html"><i class="fa-solid fa-spinner fa-spin"></i></span></a><span class="article-meta-label"> comments</span></span></div><div class="content">比赛链接：THUCTF2022（报名了比赛的账号现在（2022&#x2F;11&#x2F;15）还可以下载附件和开启实例）
学习了一下ret2dlresolve的基础。在NO RELRO的时候，程序的.dynamic节被存储在RW的地址空间，而其中的一个指针strtab指向的是动态链接的符号表。我们可以把这个符号表提取出来，修改一下，存在一个别的地方，然后把.dynamic里面的指针修改到那个地方。然后程序就会使用我们的假字符串表来进行动态符号解析！
题目分析

整个程序，一个输出函数都没有，但是保护只开了NX。很显然是要用ret2dlresolve来做。（实际上做题目的时候我还没学ret2dlresolve，然后去网上搜没有输出函数怎么打搜到的哈哈哈）
漏洞是可以在一个固定地址读入0x110个字节，并且可以栈溢出0x10个字节，也就是刚好把返回地址给覆盖掉。那么思路就是

把rop chain读到固定地址那里，然后stack pivot过去
rop chain是构造一个假的dynstr表（比如把read改成system），然后把.dynamic那里的指针改成假的dynstr，并且跳转 ...</div></div></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/2/#content-inner"><i class="fas fa-chevron-left fa-fw"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/#content-inner">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/#content-inner">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/#content-inner">6</a><a class="extend next" rel="next" href="/page/4/#content-inner"><i class="fas fa-chevron-right fa-fw"></i></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/images/ava1.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Cameudis</div><div class="author-info__description"></div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">60</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">0</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">14</div></a></div></div><div class="sticky_layout"><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/Tech/Pwn/2a2c8d32f543.html" title="【Pwn#0x14】HITCTF2023 xv6-Trusted writeup"><img src="https://i.imgtg.com/2023/04/11/8z0Vl.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【Pwn#0x14】HITCTF2023 xv6-Trusted writeup"/></a><div class="content"><a class="title" href="/Tech/Pwn/2a2c8d32f543.html" title="【Pwn#0x14】HITCTF2023 xv6-Trusted writeup">【Pwn#0x14】HITCTF2023 xv6-Trusted writeup</a><time datetime="2023-11-28T17:58:33.000Z" title="Created 2023-11-29 01:58:33">2023-11-29</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Tech/Linux/694fa68659ae.html" title="【Linux#0x00】Linux权限模型"><img src="https://i.imgtg.com/2023/04/11/8z0Vl.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【Linux#0x00】Linux权限模型"/></a><div class="content"><a class="title" href="/Tech/Linux/694fa68659ae.html" title="【Linux#0x00】Linux权限模型">【Linux#0x00】Linux权限模型</a><time datetime="2023-11-09T15:36:16.000Z" title="Created 2023-11-09 23:36:16">2023-11-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/Tech/Pwn/9f086a2e9319.html" title="【Pwn#0x14】pwnable.tw BabyStack writeup"><img src="https://i.imgtg.com/2023/04/11/8z0Vl.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="【Pwn#0x14】pwnable.tw BabyStack writeup"/></a><div class="content"><a class="title" href="/Tech/Pwn/9f086a2e9319.html" title="【Pwn#0x14】pwnable.tw BabyStack writeup">【Pwn#0x14】pwnable.tw BabyStack writeup</a><time datetime="2023-10-23T11:51:17.000Z" title="Created 2023-10-23 19:51:17">2023-10-23</time></div></div></div></div><div class="card-widget card-categories"><div class="item-headline">
            <i class="fas fa-folder-open"></i>
            <span>Categories</span>
            <a class="card-more-btn" href="/categories/" title="More">
    <i class="fas fa-angle-right"></i></a>
            </div>
            <ul class="card-category-list" id="aside-cat-list">
            <li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Daily/"><span class="card-category-list-name">Daily</span><span class="card-category-list-count">11</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Daily/%E6%9D%82%E8%B0%88/"><span class="card-category-list-name">杂谈</span><span class="card-category-list-count">5</span></a></li></ul></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Tech/"><span class="card-category-list-name">Tech</span><span class="card-category-list-count">49</span></a><ul class="card-category-list child"><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Tech/Algorithm/"><span class="card-category-list-name">Algorithm</span><span class="card-category-list-count">2</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Tech/Blog/"><span class="card-category-list-name">Blog</span><span class="card-category-list-count">3</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Tech/CSAPP/"><span class="card-category-list-name">CSAPP</span><span class="card-category-list-count">3</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Tech/EE/"><span class="card-category-list-name">EE</span><span class="card-category-list-count">1</span></a></li><li class="card-category-list-item "><a class="card-category-list-link" href="/categories/Tech/Linux/"><span class="card-category-list-name">Linux</span><span class="card-category-list-count">1</span></a></li></ul></li>
            </ul></div><div class="card-widget card-archives"><div class="item-headline"><i class="fas fa-archive"></i><span>Archives</span><a class="card-more-btn" href="/archives/" title="More">
    <i class="fas fa-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/11/"><span class="card-archive-list-date">November 2023</span><span class="card-archive-list-count">2</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/10/"><span class="card-archive-list-date">October 2023</span><span class="card-archive-list-count">2</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/09/"><span class="card-archive-list-date">September 2023</span><span class="card-archive-list-count">1</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/06/"><span class="card-archive-list-date">June 2023</span><span class="card-archive-list-count">4</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/05/"><span class="card-archive-list-date">May 2023</span><span class="card-archive-list-count">2</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/04/"><span class="card-archive-list-date">April 2023</span><span class="card-archive-list-count">5</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/03/"><span class="card-archive-list-date">March 2023</span><span class="card-archive-list-count">8</span></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2023/02/"><span class="card-archive-list-date">February 2023</span><span class="card-archive-list-count">1</span></a></li></ul></div><div class="card-widget card-webinfo"><div class="item-headline"><i class="fas fa-chart-line"></i><span>Info</span></div><div class="webinfo"><div class="webinfo-item"><div class="item-name">Article :</div><div class="item-count">60</div></div><div class="webinfo-item"><div class="item-name">UV :</div><div class="item-count" id="busuanzi_value_site_uv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">PV :</div><div class="item-count" id="busuanzi_value_site_pv"><i class="fa-solid fa-spinner fa-spin"></i></div></div><div class="webinfo-item"><div class="item-name">Last Push :</div><div class="item-count" id="last-push-date" data-lastPushDate="2023-12-25T02:48:02.355Z"><i class="fa-solid fa-spinner fa-spin"></i></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://i.imgtg.com/2023/04/11/8zHiD.png')"><div id="footer-wrap"><div class="copyright">&copy;2022 - 2023 By Cameudis</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Exp10re the W0r1d!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="Toggle between single-column and double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog fa-spin"></i></button><button id="go-up" type="button" title="Back To Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><div class="js-pjax"><script>(() => {
  function loadValine () {
    function initValine () {
      let initData = {
        el: '#vcomment',
        appId: 'Ji5y9HTOlb2QGDO0XFlWXNRy-gzGzoHsz',
        appKey: '6VqGye1352LX381YQDTOaiXs',
        serverURLs: ''
      }
      
      const valine = new Valine(initData)
    }

    if (typeof Valine === 'function') initValine() 
    else getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js').then(initValine)
  }

  window.pjax ? loadValine() : window.addEventListener('load', loadValine)
})()</script></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>